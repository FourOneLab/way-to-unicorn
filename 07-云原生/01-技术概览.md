# 云原生技术概览

最全概览肯定是CNCF官方的[LandScape](https://landscape.cncf.io/)啦。

这张图会不断更新的，一定要去官网上看，总共分为四个层次，从下往上依次是：

![image](/images/landscape-detail.png)

- Provisioning(配置云原生基础架构的工具)
- Runtime(运行时工具)
- Orchestration & Management（管理应用程序所需的工具）
- Application Definition & Development(定义和开发应用程序的工具)

蓝色外框底部有CNCF标签的是托管在云原生基金会的项目，并注明了毕业项目还是孵化项目。

白底的是开源项目，灰底的是专有项目。

抽象一下就是这样子，在最右侧还有两列横跨这四层：

![image](/images/landscape.png)

- 可观察性与分析（Observability &Analysis）
- 平台类（Platforms）

> 在每一层的每个领域中都有旨在解决相同或相似问题的不同工具。区别在于它们的实现和设计方法。
>
> 在选择时，必须仔细考虑每种功能并进行权衡，以确定适合其用例的最佳选择。尽管这带来了额外的复杂性，但选择最适合应用程序需求的数据存储，基础架构管理，消息系统等，都是至关重要的。

## 供应层（Privisioning）

创建和强化云本机应用程序基础所涉及的工具。它涵盖了：

- 自动化基础结构的创建
- 管理和配置镜像扫描
- 镜像签名和存储镜像
- 在应用程序和平台中构建身份验证授权以及处理密钥分发的工具
- 资源调配和安全领域的工具

划分为四个子领域：

- 自动化和配置工具（Automation & configuration ）：可帮助工程师无需人工干预即可构建基础环境。
- 容器仓库（Container Registry）: 存储应用程序的镜像。
- 安全与合规（Security & compliance）：涉及不同的安全领域。
- 密钥管理（Key management）：有助于加密，以确保只有授权的用户才能访问该应用程序。

### 自动化和配置工具（Automation & configuration ）

加快计算资源（虚拟机，网络，防火墙规则，负载均衡器等）的创建和配置。

> 解决了，传统上，IT流程依赖冗长且复杂的手动发布周期，甚至需要三到六个月。这些周期伴随着许多人工流程和控制，从而减缓了生产环境的变更。这些缓慢的发布周期和静态环境与云原生开发不兼容。为了实现快速的开发周期，必须动态配置基础架构，并且无需人工干预。

此类工具使工程师无需人工干预即可构建计算环境。环境设置，只需单击一个按钮，它就可以实现。手动设置很容易出错，但是一旦进行了编码，环境创建就会与所需的确切状态相匹配，这是巨大的优势。

**尽管这些工具可能采用不同的方法，但它们都旨在通过自动化配置资源减少所需的手工操作**。

### 容器仓库（Container Registry）

- 容器是用于执行软件流程的一组计算约束。容器使你无论身在何处都可以以受控方式运行代码。
- 镜像是运行容器及其过程所需的一组存档文件。可将其视为模板的一种形式，可以在其上创建无限数量的容器。
- 存储库是用于分类和存储镜像的专用Web应用程序。

> 解决了，云原生应用程序打包并作为容器运行。镜像仓库存储并提供这些容器镜像。

### 安全与合规（Security & compliance）

云原生应用程序旨在快速迭代，为了定期发布代码，必须确保代码和操作环境是安全的，并且只能由授权的工程师访问。

为了安全地运行容器，必须对容器进行扫描以查找已知漏洞并签名，以确保它们未被篡改。Kubernetes本身默认的访问控制设置比较宽松。因此，对于希望攻击系统的任何人来说，Kubernetes集群都是一个有吸引力的目标。该空间中的工具和项目有助于增强群集，并提供工具来检测系统何时出现异常。

> 解决了，加强、监视和实施平台和应用程序的安全性。从容器到Kubernetes环境，它们使你能够设置策略（用于合规性），深入了解现有漏洞，捕获错误配置以及增强容器和集群的安全性。

具体的安全性工具分类：

- 审计与合规(Audit and compliance)
- 生产环境中强化的途径
  - 代码扫描
  - 漏洞扫描
  - 镜像签名
- 政策制定与执行
- 网络层安全

### 密钥管理（Key management）

> 密钥是用于加密或签名数据的字符串，它加密数据，以便只拥有正确密钥的才能解密数据。

随着应用程序适应新的云原生世界，安全工具也在不断发展以满足新的安全需求。此类别中的工具和项目涵盖了从如何安全地存储密码和其他机密信息（敏感数据，例如API密钥，密钥等）到如何从微服务环境中安全删除密码和机密信息等。

> 解决了，云原生环境高度动态，按需完全编程（无人参与）和自动化的密钥分发。应用程序还必须知道给定的请求是否来自有效来源（身份验证），以及该请求是否有权执行其尝试执行的任何操作。通常将其称为AuthN和AuthZ。

此类别中的工具可以分为两组：

- 专注于密钥生成，存储，管理和轮换（Vault是一种相当通用的密钥管理工具）
- 专注于单点登录和身份管理（Keycloak是一种身份代理，可用于管理不同服务的访问密钥）

## 运行时层（Runtime）

- 从狭义上讲，运行时是运行应用程序的特定沙箱环境（应用程序运行所需的最低限度）
- 从广义上讲，运行时是应用程序运行所需要的任何工具

在CNCF云原生环境中，运行时重点放在对容器化应用特别重要的组件上，划分为三个子领域：

- 云原生存储（Cloud native storage）：为容器化的应用程序提供了虚拟化磁盘或持久性。
- 容器运行时（Container runtime）：为容器提供了约束，资源和安全性等。
- 云网络（Cloud native networking）：分布式系统的节点通过其进行连接和通信的网络。

## 编排和管理层（Orchestration & Management）

按照安全性标准自动搭建了基础结构（供应层），并设置了应用程序需要运行的工具（运行时层），就需要知道如何编排和管理其应用程序。

编排和管理层，把所有容器化应用程序作为一个组进行管理。还要确定是否需要和其他服务相互通信并进行协调。同时，云原生应用程序具有良好的可扩展性。

划分为六个子领域:

- 编排和调度（Orchestration & scheduling）：部署和管理容器集群，以确保它们具有弹性，松耦合和可伸缩性。具有代表性的容器编排工具就是Kubernetes。
- 服务发现（Coordination and service discovery）：服务可以相互通信的工具。
- 远程过程调用（RPC）：跨节点上的服务进行通信的技术。
- 服务代理（Service proxy）：代理的唯一目的是对服务通信施加更多控制，它不会对通信本身添加任何内容。这些代理对于下面提到的服务网格至关重要。
- API网关：一个抽象层，外部应用程序可以通过它进行通信。
- 服务网格（Service mesh）：在某种程度上类似于API网关，它是应用程序通过其进行通信的专用基础结构层，但是它提供了策略驱动的服务的通信。此外，它可能包括从加密、服务发现、到应用程序可观察性的所有内容。

## 应用程序定义和开发层（Application Definition & Development）

侧重于构建应用程序和使其运行的工具，划分为四个子领域：

- 数据库（ Databases）：使应用程序能够以有组织的方式收集数据。
- 流和消息传递（ Streaming & messaging）：使应用程序能够发送和接收消息（事件和流）。它不是网络层，而是用于对消息进行排队和处理的工具。
- 应用程序定义和镜像构建（ Application definition &image build ）：是帮助配置，维护和运行容器镜像的服务。
- 持续集成和持续交付（CI/CD）：使开发人员能够自动测试代码，自动打包，甚至还可以自动部署到生产环境中。

## 可观察性与分析（Observability &Analysis）

为了降低解决软件问题的时间，需要监视和分析应用程序的各个方面，以便立即发现并纠正任何异常情况。在复杂的环境中故障随时会发生，而这些工具将通过帮助尽快识别和解决故障来帮助减轻故障的负面影响。

此类别遍历并监视所有层，因此它在侧面，而不是嵌入在特定层中，划分为四个子领域：

- 日志记录（Logging）：收集事件日志（有关进程的信息）的工具。
- 监视（Monitoring）：收集指标（系统参数，例如RAM可用性等），监视运行状况。
- 跟踪（Tracing）：比监视更进一步，这与服务网格相关。
- 混沌工程（Chaos engineering）：是对生产中的软件进行测试的工具，可以在交付之前识别缺陷并加以修复。

## 平台类（Platforms）

每一层的每个子领域都解决了一个特定的问题。仅使用一个或几个并不能提供管理应用程序所需的全部功能。需要一个编排工具，覆盖多层，将不同的工具捆绑在一起，以解决更大的问题。

所有类别都围绕Kubernetes展开，平台层划分为四个子领域：

- Kubernetes发行版：未经修改的开源代码（尽管有人对其进行了修改），并跟踪市场需求添加相应功能。
- Kubernetes托管：类似于发行版，在提供商的基础架构上进行管理。
- Kubernetes安装程序：使用它们可以自动执行Kubernetes的安装和配置过程。
- PaaS /容器服务：与Kubernetes托管相似，但包含了广泛的应用程序部署工具集（通常是云原生环境的一部分）。
